// data
var nodeData = {"name": "World", "children": [{
            "name": "Africa", "children": [
              {"name": "Egypt", "children": [
                {"name": "religion", "size": 11},
                {"name": "science" , "size": 12}
                ]},
              {"name": "Kenya", "children": [
                  {"name": "science", "size": 2}
                  ]},
              {"name": "Lybia", "children": [
                {"name": "religion", "size": 2},
                {"name": "science", "size": 1}
                ]},
              {"name": "Malawi", "children": [
                  {"name": "science", "size":2}
                  ]},
              {"name": "Morocco", "children": [
                  {"name": "science", "size" : 1}
                  ]},
              {"name": "Saudi Arabia", "children": [
                      {"name": "religion", "size" : 1}
                      ]},
              {"name": "Algeria", "children": [
                {"name": "religion", "size": 1},
                {"name":"science", "size" : 1}
                ]},
              {"name": "Sudan", "children": [
                      {"name": "religion", "size" : 1}
                      ]},
              {"name": "South Africa", "children": [
                {"name": "religion", "size": 1},
                {"name": "science", "size" : 4}
              ]},
              {"name": "Tunisia", "children": [
                      {"name": "religion", "size" : 1}
                      ]}
                    ]}, // end of Africa and Middle East

                    {"name": "Europe", "children": [
                          {"name": "Austria",  "children": [
                            {"name": "religion", "size": 1},
                            {"name": "science", "size": 23}
                            ]},
                          {"name": "Belarus", "children": [
                              {"name": "science", "size" : 3}
                              ]},
                          {"name": "Belgium", "children": [
                            {"name": "religion", "size": 1},
                            {"name": "science", "size": 14}
                            ]},
                          {"name": "Bosnia and Herzegovina", "children": [
                              {"name": "science", "size" : 1}
                              ]},
                          {"name": "Bulgaria", "children": [
                              {"name": "science", "size" : 1}
                              ]},
                          {"name": "Croatia", "children": [
                            {"name": "religion", "size" : 4},
                            {"name": "science", "size"  : 5}
                            ]},
                          {"name": "Czech Republic", "children": [
                            {"name": "religion", "size" : 3},
                            {"name": "science", "size" : 11}
                            ]},
                          {"name": "Denmark", "children": [
                              {"name": "science", "size" : 16}
                              ]},
                          {"name": "Estonia", "children": [
                            {"name": "religion", "size": 1},
                            {"name": "science", "size" : 2}
                            ]},
                          {"name": "Finland", "children": [
                              {"name":"science", "size" : 6}
                              ]},
                          {"name": "France", "children": [
                            {"name":"religion", "size": 30},
                            {"name":"science", "size" : 135}
                            ]},
                          {"name": "Germany", "children": [
                            {"name":"religion", "size": 12},
                            {"name":"science", "size" : 165}
                            ]},
                          {"name": "Greece", "children": [
                            {"name":"religion", "size": 7},
                            {"name":"science", "size" : 3}
                            ]},
                          {"name": "Hungary", "children": [
                            {"name":"religion", "size": 1},
                            {"name":"science", "size" : 17}
                            ]},
                          {"name": "Ireland", "children": [
                            {"name":"religion", "size": 2},
                            {"name":"science", "size" : 6}
                            ]},
                          {"name": "Italy", "children": [
                            {"name":"religion", "size": 230},
                            {"name":"science", "size" : 47}
                            ]},
                          {"name": "Latvia", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Lithuania", "children": [
                              {"name":"science", "size" : 4}
                              ]},
                          {"name": "Luxembourg", "children": [
                              {"name":"science", "size" : 2}
                              ]},
                          {"name": "Moldova", "children": [
                              {"name":"science" , "size": 1}
                              ]},
                          {"name": "Montenegro", "children": [
                              {"name":"religion", "size" : 1}
                              ]},
                          {"name": "Netherlands", "children": [
                            {"name":"religion", "size": 1},
                            {"name":"science", "size" : 29}
                            ]},
                          {"name": "Norway", "children": [
                            {"name":"religion", "size": 1},
                            {"name":"science", "size" : 12}
                            ]},
                          {"name": "Poland", "children": [
                            {"name":"religion", "size": 4},
                            {"name":"science", "size" : 44}
                            ]},
                          {"name": "Portugal", "children": [
                            {"name":"religion", "size": 2},
                            {"name":"science", "size" : 2}
                            ]},
                          {"name": "Romania", "children": [
                            {"name":"religion", "size": 1},
                            {"name":"science", "size" : 4}
                            ]},
                          {"name": "Russia", "children": [
                              {"name":"science", "size" : 52}
                              ]},
                          {"name": "Slovakia", "children": [
                            {"name":"religion", "size": 1},
                            {"name":"science", "size" : 1}
                            ]},
                          {"name": "Slovenia", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Spain", "children": [
                            {"name":"religion", "size": 12},
                            {"name":"science", "size" : 11}
                            ]},
                          {"name": "Sweden", "children": [
                            {"name":"religion", "size": 3},
                            {"name":"science", "size" : 22}
                            ]},
                          {"name": "Switzerland", "children": [
                            {"name":"religion", "size": 2},
                            {"name":"science", "size" : 26}
                            ]},
                          {"name": "Turkey", "children": [
                              {"name":"religion", "size": 20},
                              {"name":"science" , "size": 17}
                              ]},
                          {"name": "Ukraine", "children": [
                              {"name":"science" , "size": 15}
                              ]},
                          {"name": "United Kingdom", "children": [
                              {"name":"religion", "size": 12},
                              {"name":"science", "size" : 188}
                              ]}]
                    }, // end of Europe

                    {
                        "name": "Asia", "children": [
                          {"name": "Afghanistan", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Azerbaijan", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Armenia", "children": [
                              {"name":"religion", "size" : 1}
                              ]},
                          {"name": "Bangladesh", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "China", "children": [
                            {"name":"religion", "size": 2},
                            {"name":"science", "size" : 11}
                            ]},
                          {"name": "Cyprus", "children": [
                            {"name":"religion", "size": 1},
                            {"name":"science", "size" : 1}
                            ]},
                          {"name": "Georgia", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "India", "children": [
                            {"name":"religion", "size": 4},
                            {"name":"science", "size" : 13}
                            ]},
                          {"name": "Indonesia", "children": [
                              {"name":"science" , "size": 1}
                              ]},
                          {"name": "Iran", "children": [
                            {"name":"religion", "size": 8},
                            {"name":"science" , "size": 8}
                            ]},
                          {"name": "Iraq",  "children": [
                            {"name":"religion", "size": 7},
                            {"name":"science" , "size": 1}
                            ]},
                          {"name": "Israel", "children": [
                            {"name":"religion", "size": 33},
                            {"name":"science", "size" : 4}
                            ]},
                          {"name": "Japan", "children": [
                              {"name":"science", "size" : 16}
                              ]},
                          {"name": "Jordan", "children": [
                              {"name":"religion", "size" : 2}
                              ]},
                          {"name": "North Korea", "children": [
                              {"name":"religion", "size" : 1}
                              ]},
                          {"name": "Pakistan", "children": [
                            {"name":"religion", "size": 1},
                            {"name":"science" , "size": 2}
                            ]},
                          {"name": "Palestine", "children": [
                              {"name":"religion" , "size": 11}
                              ]},
                          {"name": "Saudi Arabia", "children": [
                            {"name":"religion", "size": 10},
                            {"name":"science", "size" : 2}
                            ]},
                          {"name": "South Korea", "children": [
                              {"name":"science", "size" : 2}
                              ]},
                          {"name": "Sri Lanka", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Syria", "children": [
                              {"name":"religion", "size" : 7}
                              ]},
                          {"name": "Taiwan", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Timor-Leste", "children": [
                              {"name":"religion" , "size": 1}
                              ]},
                          {"name": "Uzbekistan", "children": [
                              {"name":"religion" , "size": 1}
                              ]},
                          {"name": "Vietnam", "children": [
                              {"name":"science" , "size": 1}
                              ]},
                          {"name": "Yemen", "children": [
                              {"name":"religion", "size" : 2}
                              ]}
                            ]}, // end of Asia

                            {"name": "North America", "children": [
                          {"name": "United States", "children": [
                            {"name":"religion", "size": 4},
                            {"name":"science" , "size": 340}
                            ]},
                          {"name": "Canada",  "children": [
                              {"name":"science", "size" : 19}
                              ]},
                          {"name": "Greenland", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Haiti", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Mexico", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Saint Kitts and Nevis", "children": [
                              {"name":"science", "size" : 1}
                              ]},
                          {"name": "Saint Lucia", "children": [
                              {"name":"science", "size" : 1}
                              ]}
                            ]}, // end of North America

                      {
                        "name": "South America", "children": [
                          {"name": "El Salvador", "children": [
                              {"name":"religion", "size" : 1}
                              ]},
                          {"name": "Peru", "children": [
                              {"name":"religion", "size" : 1}
                              ]},
                          {"name": "Brazil", "children": [
                              {"name":"science", "size" : 3}
                              ]},
                          {"name": "Chile", "children": [
                              {"name":"science" , "size": 1}
                              ]},
                          {"name": "Venezuela", "children": [
                              {"name":"science" , "size": 1}
                              ]},
                          {"name": "Argentina", "children": [
                              {"name":"science" , "size": 2}
                              ]}
                        ]}, // end of South America

                    {"name": "Ocenia", "children": [
                          {"name": "Australia", "children": [
                              {"name":"science" , "size": 13}
                              ]},
                          {"name": "New Zealand", "children": [
                              {"name":"science" , "size": 3}
                              ]}
                      ]}


                  ]};

var width = $("#stackedArea").width();
    height = $("#stackedArea").height();
    radius = (Math.min(width, height) / 2) - 10;

var formatNumber = d3.format(",d");

var x = d3.scaleLinear()
    .range([0, 2 * Math.PI]);

var y = d3.scaleSqrt()
    .range([0, radius]);

var color = d3.scaleOrdinal(d3.schemeCategory20);

var partition = d3.partition();

var arc = d3.arc()
      .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x0))); })
      .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x1))); })
      .innerRadius(function(d) { return Math.max(0, y(d.y0)); })
      .outerRadius(function(d) { return Math.max(0, y(d.y1)); });

var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
    .append("g")
      .attr("transform", "translate(" + width / 2 + "," + (height / 2) + ")");


// Importing data

    root = d3.hierarchy(nodeData);
    root.sum(function(d) { return d.size; });
    svg.selectAll("path")
        .data(partition(root).descendants())
      .enter().append("path")
        .attr("d", arc)
        .style("fill", function(d) { return color((d.children ? d : d.parent).data.name); })
        .on("click", click)
      .append("title")
        .text(function(d) { return d.data.name + "\n" + formatNumber(d.value); });


  function click(d) {
    svg.transition()
        .duration(750)
        .tween("scale", function() {
          var xd = d3.interpolate(x.domain(), [d.x0, d.x1]),
              yd = d3.interpolate(y.domain(), [d.y0, 1]),
              yr = d3.interpolate(y.range(), [d.y0 ? 20 : 0, radius]);
          return function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); };
        })
      .selectAll("path")
        .attrTween("d", function(d) { return function() { return arc(d); }; });
  }

  d3.select(self.frameElement).style("height", height + "px");
